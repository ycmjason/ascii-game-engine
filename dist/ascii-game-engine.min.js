function AsciiGameEngine(n){this.canvas=n,this.components=[],this.mainLoop=0,this.currentTick=0,this.fps=60;var i=n=>{return i=>{i.preventDefault();var t=new AsciiGameEngine.Key(i);this.components.forEach((i=>{i[n]&&i[n](t)}))}};this.canvas.keydown(i("keydown")),this.canvas.keyup(i("keyup"))}AsciiGameEngine.prototype.start=function(){var n,i=()=>{this.components.forEach((i=>{var t=this.canvas.draw(i.toString(),i.position,i.overflowStrategy);t.forEach((t=>{n[t]||(n[t]=[]),n[t].push(i)}))}))},t=()=>{var i=Object.keys(n);i.forEach((i=>{components=n[i],components.length>1&&(console.log("collision!"),components.forEach((n=>{if(n.onCollision){var i=components.filter((i=>i!=n));n.onCollision(i)}})))}))},e=()=>{n={},this.currentTick+=1,this.components.forEach((n=>n.tick(this.currentTick))),this.canvas.clear(),i(),t(),this.canvas.display()};this.mainLoop=setInterval(e,1/this.fps*1e3)},AsciiGameEngine.prototype.stop=function(){clearInterval(this.mainLoop)},AsciiGameEngine.prototype.addComponent=function(n){var i;for(this.components.indexOf(n)>-1&&console.error("Adding existing component."),i=0;i<this.components.length&&!(this.components[i].z_index>n.z_index);i++);this.components.splice(i,0,n)},AsciiGameEngine.prototype.removeComponent=function(n){this.components=this.components.filter((i=>i!=n))},AsciiGameEngine.init=function(n,i,t){var e=new AsciiGameEngine.Canvas($(n),i,t);return new AsciiGameEngine(e)},AsciiGameEngine.Canvas=function(n,i,t){n.css("width",i+"ch"),n.css("white-space","pre"),n.attr("tabindex",0),n.css("outline","none"),this.$canvas=n,this.width=i,this.height=t,this.content=[],this.clearedContent=[];for(var e=0;e<this.width*this.height;e++)this.clearedContent.push("&nbsp;");this.clear()},AsciiGameEngine.Canvas.prototype.display=function(){for(var n=this.content.slice(0),i=0;i<this.height;i++){var t=(i+1)*this.width+i;n.splice(t,0,"\n")}this.$canvas.html(n.join(""))},AsciiGameEngine.Canvas.prototype.draw=function(n,i,t){t=AsciiGameEngine.Canvas.overflowStrategies[t||"hidden"];var e=function(n,i){for(var t=[],e=0;e<n.length;e++)n.join("").substr(e,i.length)==i?(t.push(i),e+=i.length-1):t.push(n[e]);return t};n=n||"",i=i||[0,0];var s=n.split(/\n|\r|\r\n|\n\r/),o=[];return s.forEach(((n,s)=>{n=e(n.split(""),"&nbsp;");for(var a=0;a<n.length;a++)if(" "!=n[a]){var c=t([i[0]+a,i[1]+s]);if(o.push(c),c[0]>=0&&c[1]>=0){var r=c[1]*this.width+c[0];this.content[r]=n[a]}}})),o},AsciiGameEngine.Canvas.prototype.write=function(n,i,t){return n=n.replace(/ /g,"&nbsp;"),this.draw(n,i,t)},AsciiGameEngine.Canvas.prototype.clear=function(){this.content=this.clearedContent.slice(0)},AsciiGameEngine.Canvas.prototype.keyup=function(n){this.$canvas.keyup(n)},AsciiGameEngine.Canvas.prototype.keydown=function(n){this.$canvas.keydown(n)},AsciiGameEngine.Canvas.overflowStrategies={loopback:n=>{var i=(n,i)=>(n%i+i)%i,t=i(n[0],this.width),e=i(n[1],this.height);return[t,e]},hidden:n=>{var i=n[0]<this.width?n[0]:-1,t=n[1]<this.height?n[1]:-1;return[i,t]},bounded:n=>{var i=n[0],t=n[1];return i>=this.width&&(i=this.width-1),0>i&&(i=0),t>=this.height&&(t=this.height-1),0>t&&(t=0),[i,t]}},AsciiGameEngine.Key=function(n){var i=n.keyCode,t=n.shiftKey;if(i>=65&&90>=i)t?this.name=String.fromCharCode(i):this.name=String.fromCharCode(i+32);else if(i>=48&&57>=i)this.name=i-48+"";else{var e={13:"enter",16:"shift",32:"space",37:"left",38:"up",39:"right",40:"down"};this.name=e[i]}this.event=n};