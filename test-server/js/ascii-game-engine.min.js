function AsciiGameEngine(n){this.canvas=n,this.components=[],this.mainLoop=0,this.currentTick=0,this.fps=60;var t=n=>{return t=>{t.preventDefault();var i=new AsciiGameEngine.Key(t);this.components.forEach((t=>{t[n]&&t[n](i)}))}};this.canvas.keydown(t("keydown")),this.canvas.keyup(t("keyup"))}AsciiGameEngine.prototype.start=function(){var n=()=>{this.components.forEach((n=>{this.canvas.draw(n.toString(),n.coordinate,n.overflowStrategy)}))},t=()=>{},i=()=>{this.currentTick+=1,this.components.forEach((n=>n.tick(this.currentTick))),this.canvas.clear(),t(),n(),this.canvas.display()};this.mainLoop=setInterval(i,1/this.fps*1e3)},AsciiGameEngine.prototype.stop=function(){clearInterval(this.mainLoop)},AsciiGameEngine.prototype.addComponent=function(n){var t;for(this.components.indexOf(n)>-1&&console.error("Adding existing component."),t=0;t<this.components.length&&!(this.components[t].z_index>n.z_index);t++);this.components.splice(t,0,n)},AsciiGameEngine.prototype.removeComponent=function(n){this.components=this.components.filter((t=>t!=n))},AsciiGameEngine.init=function(n,t,i){var e=new AsciiGameEngine.Canvas($(n),t,i);return new AsciiGameEngine(e)},AsciiGameEngine.Canvas=function(n,t,i){n.css("width",t+"ch"),n.css("white-space","pre"),n.attr("tabindex",0),n.css("outline","none"),this.$canvas=n,this.width=t,this.height=i,this.content=[],this.clearedContent=[];for(var e=0;e<this.width*this.height;e++)this.clearedContent.push("&nbsp;");this.clear()},AsciiGameEngine.Canvas.prototype.display=function(){for(var n=this.content.slice(0),t=0;t<this.height;t++){var i=(t+1)*this.width+t;n.splice(i,0,"\n")}this.$canvas.html(n.join(""))},AsciiGameEngine.Canvas.prototype.pos2coord=function(n,t,i,e){e=this.overflowStrategies(e);var s=function(n,t){for(var i=[],e=0;e<n.length;e++)n.join("").substr(e,t.length)==t?(i.push(t),e+=t.length-1):i.push(n[e]);return i};n=n||"",t=t||[0,0];var o=n.split(/\n|\r|\r\n|\n\r/);o.forEach(((n,i)=>{n=s(n.split(""),"&nbsp;");for(var o=0;o<n.length;o++)if(" "!=n[o]){var a=e([t[0]+o,t[1]+i]);if(a[0]>=0&&a[1]>=0){var r=a[1]*this.width+a[0];this.content[r]=n[o]}}}))},AsciiGameEngine.Canvas.prototype.draw=function(n,t,i){i=this.overflowStrategies(i);var e=function(n,t){for(var i=[],e=0;e<n.length;e++)n.join("").substr(e,t.length)==t?(i.push(t),e+=t.length-1):i.push(n[e]);return i};n=n||"",t=t||[0,0];var s=n.split(/\n|\r|\r\n|\n\r/);s.forEach(((n,s)=>{n=e(n.split(""),"&nbsp;");for(var o=0;o<n.length;o++)if(" "!=n[o]){var a=i([t[0]+o,t[1]+s]);if(a[0]>=0&&a[1]>=0){var r=a[1]*this.width+a[0];this.content[r]=n[o]}}}))},AsciiGameEngine.Canvas.prototype.write=function(n,t,i){return n=n.replace(/ /g,"&nbsp;"),this.draw(n,t,i)},AsciiGameEngine.Canvas.prototype.clear=function(){this.content=this.clearedContent.slice(0)},AsciiGameEngine.Canvas.prototype.keyup=function(n){this.$canvas.keyup(n)},AsciiGameEngine.Canvas.prototype.keydown=function(n){this.$canvas.keydown(n)},AsciiGameEngine.Canvas.prototype.overflowStrategies=function(n){switch(n=n||"hidden"){case"loopback":return n=>{var t=(n,t)=>(n%t+t)%t,i=t(n[0],this.width),e=t(n[1],this.height);return[i,e]};case"bounded":return n=>{var t=n[0],i=n[1];return t>=this.width&&(t=this.width-1),0>t&&(t=0),i>=this.height&&(i=this.height-1),0>i&&(i=0),[t,i]};case"hidden":default:return n=>{var t=n[0]<this.width?n[0]:-1,i=n[1]<this.height?n[1]:-1;return[t,i]}}},AsciiGameEngine.Key=function(n){var t=n.keyCode,i=n.shiftKey;if(t>=65&&90>=t)i?this.name=String.fromCharCode(t):this.name=String.fromCharCode(t+32);else if(t>=48&&57>=t)this.name=t-48+"";else{var e={13:"enter",16:"shift",32:"space",37:"left",38:"up",39:"right",40:"down"};this.name=e[t]}this.event=n};