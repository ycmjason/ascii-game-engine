function AsciiGameEngine(n){this.canvas=n,this.components=[],this.mainLoop=0,this.currentTick=0,this.fps=60;var t=n=>{return t=>{t.preventDefault();var i=new AsciiGameEngine.Key(t);this.components.forEach((t=>{t[n]&&t[n](i)}))}};let i=["keydown","keyup"];i.forEach((n=>this.canvas[n](t(n))))}AsciiGameEngine.prototype.start=function(){var n=()=>{this.components.forEach((n=>{this.canvas.draw(n.toString(),n.position)}))},t=()=>{this.currentTick+=1,this.components.forEach((n=>n.tick(this.currentTick))),this.canvas.clear(),n()};this.mainLoop=setInterval(t,1/this.fps*1e3)},AsciiGameEngine.prototype.stop=function(){clearInterval(this.mainLoop)},AsciiGameEngine.prototype.addComponent=function(n){var t;for(this.components.indexOf(n)>-1&&console.error("Adding existing component."),t=0;t<this.components.length&&!(this.components[t].z_index>n.z_index);t++);this.components.splice(t,0,n)},AsciiGameEngine.prototype.removeComponent=function(n){this.components=this.components.filter((t=>t!=n))},AsciiGameEngine.prototype.on=function(n,t){},AsciiGameEngine.init=function(n,t,i){var e=new AsciiGameEngine.Canvas($(n),t,i);return new AsciiGameEngine(e)},AsciiGameEngine.Canvas=function(n,t,i){n.css("width",t+"ch"),n.css("height","auto"),n.css("white-space","pre"),n.attr("tabindex",0),n.css("outline","none"),this.$canvas=n,this.width=t,this.height=i,this.content=[],this.clearedContent=[];for(var e=0;e<this.width*this.height;e++)this.clearedContent.push("&nbsp;");this.clear()},AsciiGameEngine.Canvas.prototype.display=function(){for(var n=this.content.slice(0),t=0;t<this.height;t++){var i=(t+1)*this.width+t;n.splice(i,0,"\n")}this.$canvas.html(n.join(""))},AsciiGameEngine.Canvas.prototype.getPositions=function(n,t){var i=function(n,t){return(n%t+t)%t},e=function(n,t){for(var i=[],e=0;e<n.length;e++)n.join("").substr(e,t.length)==t?(i.push(t),e+=t.length-1):i.push(n[e]);return i};n=n||"",t=t||[0,0];var s=n.split(/\n|\r|\r\n|\n\r/),o=[];return s.forEach(((n,s)=>{n=e(n.split(""),"&nbsp;");for(var a=0;a<n.length;a++)if(" "!=n[a]){var c=i(t[0]+a,this.width),r=i(t[1]+s,this.height);o.push([c,r])}})),o},AsciiGameEngine.Canvas.prototype.draw=function(n,t){var i=function(n,t){return(n%t+t)%t},e=function(n,t){for(var i=[],e=0;e<n.length;e++)n.join("").substr(e,t.length)==t?(i.push(t),e+=t.length-1):i.push(n[e]);return i};n=n||"",t=t||[0,0];var s=n.split(/\n|\r|\r\n|\n\r/);s.forEach(((n,s)=>{n=e(n.split(""),"&nbsp;");for(var o=0;o<n.length;o++)if(" "!=n[o]){var a=i(t[0]+o,this.width),c=i(t[1]+s,this.height),r=c*this.width+a;this.content[r]=n[o]}})),this.display()},AsciiGameEngine.Canvas.prototype.write=function(n,t){n=n.replace(/ /g,"&nbsp;"),this.draw(n,t)},AsciiGameEngine.Canvas.prototype.clear=function(){this.content=this.clearedContent.slice(0)},AsciiGameEngine.Canvas.prototype.keyup=function(n){this.$canvas.keyup(n)},AsciiGameEngine.Canvas.prototype.keydown=function(n){this.$canvas.keydown(n)},AsciiGameEngine.Key=function(n){var t=n.keyCode,i=n.shiftKey;if(t>=65&&90>=t)i?this.name=String.fromCharCode(t):this.name=String.fromCharCode(t+32);else if(t>=48&&57>=t)this.name=t-48+"";else{var e={13:"enter",16:"shift",32:"space",37:"left",38:"up",39:"right",40:"down"};this.name=e[t]}this.event=n};