function AsciiGameEngine(t){this.canvas=t,this.components=[],this.mainLoop=0,this.currentTick=0,this.fps=60,this.downedKeys=[],this.canvas.keydown((t=>{this.downedKeys.filter((n=>n.keyCode==t.keyCode)).length<=0&&this.downedKeys.push({keyCode:t.keyCode})})),this.canvas.keyup((t=>{this.downedKeys=this.downedKeys.filter((n=>n.keyCode!=t.keyCode))})),this.keyEvents=[]}function Canvas(t,n,i){t.css("width",n+"ch"),t.css("height","auto"),t.css("white-space","pre"),t.attr("tabindex",0),t.css("outline","none"),this.$canvas=t,this.width=n,this.height=i,this.content=[],this.clearedContent=[];for(var e=0;e<this.width*this.height;e++)this.clearedContent.push("&nbsp;");this.clear()}AsciiGameEngine.prototype.start=function(){var t=()=>{this.components.forEach((t=>{this.canvas.draw(t.toString(),t.position)}))},n=()=>{this.currentTick+=1,this.components.forEach((t=>t.tick(this.currentTick))),this.canvas.clear(),t()};this.mainLoop=setInterval(n,1/this.fps*1e3)},AsciiGameEngine.prototype.stop=function(){clearInterval(this.mainLoop)},AsciiGameEngine.prototype.addComponent=function(t){var n;for(this.components.indexOf(t)>-1&&console.error("Adding existing component."),n=0;n<this.components.length&&!(this.components[n].z_index>t.z_index);n++);this.components.splice(n,0,t)},AsciiGameEngine.prototype.removeComponent=function(t){this.components=this.components.filter((n=>n!=t))},AsciiGameEngine.prototype.on=function(t,n){},AsciiGameEngine.init=function(t,n,i){var e=new Canvas($(t),n,i);return new AsciiGameEngine(e)},Canvas.prototype.display=function(){for(var t=this.content.slice(0),n=0;n<this.height;n++){var i=(n+1)*this.width+n;t.splice(i,0,"\n")}this.$canvas.html(t.join(""))},Canvas.prototype.draw=function(t,n){var i=function(t,n){for(var i=[],e=0;e<t.length;e++)t.join("").substr(e,n.length)==n?(i.push(n),e+=n.length-1):i.push(t[e]);return i};t=t||"",n=n||[0,0];var e=t.split(/\n|\r|\r\n|\n\r/);e.forEach(((t,e)=>{var s=n[0]%this.width,o=(n[1]+e)%this.height,c=o*this.width+s;t=i(t.split(""),"&nbsp;");for(var h=0;h<t.length;h++)" "!=t[h]&&(this.content[c+h]=t[h])})),this.display()},Canvas.prototype.write=function(t,n){t=t.replace(/ /g,"&nbsp;"),this.draw(t,n)},Canvas.prototype.clear=function(){this.content=this.clearedContent.slice(0)},Canvas.prototype.keyup=function(t){this.$canvas.keyup(t)},Canvas.prototype.keydown=function(t){this.$canvas.keydown(t)};