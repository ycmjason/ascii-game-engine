function AsciiGameEngine(n){this.canvas=n,this.components=[],this.mainLoop=0,this.currentTick=0,this.fps=60;var i=n=>{return i=>{i.preventDefault();var t=new AsciiGameEngine.Key(i);this.components.forEach((i=>{i[n]&&i[n](t)}))}};this.canvas.keydown(i("keydown")),this.canvas.keyup(i("keyup"))}AsciiGameEngine.prototype.start=function(){var n=()=>{this.components.forEach((n=>{this.canvas.draw(n.toString(),n.position)}))},i=()=>{this.currentTick+=1,this.components.forEach((n=>n.tick(this.currentTick))),this.canvas.clear(),n()};this.mainLoop=setInterval(i,1/this.fps*1e3)},AsciiGameEngine.prototype.stop=function(){clearInterval(this.mainLoop)},AsciiGameEngine.prototype.addComponent=function(n){var i;for(this.components.indexOf(n)>-1&&console.error("Adding existing component."),i=0;i<this.components.length&&!(this.components[i].z_index>n.z_index);i++);this.components.splice(i,0,n)},AsciiGameEngine.prototype.removeComponent=function(n){this.components=this.components.filter((i=>i!=n))},AsciiGameEngine.prototype.on=function(n,i){},AsciiGameEngine.init=function(n,i,t){var e=new AsciiGameEngine.Canvas($(n),i,t);return new AsciiGameEngine(e)},AsciiGameEngine.Canvas=function(n,i,t){n.css("width",i+"ch"),n.css("height","auto"),n.css("white-space","pre"),n.attr("tabindex",0),n.css("outline","none"),this.$canvas=n,this.width=i,this.height=t,this.content=[],this.clearedContent=[];for(var e=0;e<this.width*this.height;e++)this.clearedContent.push("&nbsp;");this.clear()},AsciiGameEngine.Canvas.prototype.display=function(){for(var n=this.content.slice(0),i=0;i<this.height;i++){var t=(i+1)*this.width+i;n.splice(t,0,"\n")}this.$canvas.html(n.join(""))},AsciiGameEngine.Canvas.prototype.draw=function(n,i){var t=function(n,i){return(n%i+i)%i},e=function(n,i){for(var t=[],e=0;e<n.length;e++)n.join("").substr(e,i.length)==i?(t.push(i),e+=i.length-1):t.push(n[e]);return t};n=n||"",i=i||[0,0];var s=n.split(/\n|\r|\r\n|\n\r/);s.forEach(((n,s)=>{n=e(n.split(""),"&nbsp;");for(var o=0;o<n.length;o++)if(" "!=n[o]){var a=t(i[0]+o,this.width),c=t(i[1]+s,this.height),h=c*this.width+a;this.content[h]=n[o]}})),this.display()},AsciiGameEngine.Canvas.prototype.write=function(n,i){n=n.replace(/ /g,"&nbsp;"),this.draw(n,i)},AsciiGameEngine.Canvas.prototype.clear=function(){this.content=this.clearedContent.slice(0)},AsciiGameEngine.Canvas.prototype.keyup=function(n){this.$canvas.keyup(n)},AsciiGameEngine.Canvas.prototype.keydown=function(n){this.$canvas.keydown(n)},AsciiGameEngine.Key=function(n){var i=n.keyCode,t=n.shiftKey;if(i>=65&&90>=i)t?this.name=String.fromCharCode(i):this.name=String.fromCharCode(i+32);else if(i>=48&&57>=i)this.name=i-48+"";else{var e={13:"enter",16:"shift",32:"space",37:"left",38:"up",39:"right",40:"down"};this.name=e[i]}this.event=n};